<% include ../../partials/header %> 
<link rel="stylesheet" href="../stylesheets/pagination.css" />
<script type="text/javascript" src="../js/jquery.pagination.js"></script>
<script src="../js/ajax.js" type='text/javascript'></script>

<h2 class='font'>订单管理</h2>

<div class="container">
    <!-- 导航分页，显示不同内容 -->
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#not_verify">待校检</a></li>
            <li><a data-toggle="tab" href="#done">已完成</a></li>
            <li><a data-toggle="tab" href="#return">待退货</a></li>
        </ul>
    </div>
          
    <div class="tab-content">
        <div id="not_verify" class="tab-pane fade in active">
            <div class='orderpage panel panel-default' id='orderpage'>
                <table data-toggle="table" data-url="" class='table' id='item-table'>
                    <tr><th>商品</th><th>价格</th><th>数量</th><th>总价格</th><th>客户</th><th>邮箱</th><th>支付类型</th><th>状态</th><th>操作</th></tr>
                </table>
            </div>
        </div>
    
        <div id="done" class="tab-pane fade">
            <div class='orderpage panel panel-default' id='orderpage'>
                <table class='table' id='item-table'>
                    <tr><th>商品</th><th>价格</th><th>数量</th><th>总价格</th><th>客户</th><th>邮箱</th><th>支付类型</th><th>状态</th><th>操作</th></tr>
                </table>
            </div>
        </div>
        <div id="return" class="tab-pane fade">
            <div class='orderpage panel panel-default' id='orderpage'>
                <table class='table' id='item-table'>
                    <tr><th>商品</th><th>价格</th><th>数量</th><th>总价格</th><th>客户</th><th>邮箱</th><th>支付类型</th><th>状态</th><th>操作</th></tr>
                </table>
            </div>
        </div>
    </div>

    <div class='setPageDiv'>
        <div class='Pagination' id='Pagination'></div>
    </div>


<script>
    //获取api中待完成的订单
    var res = ajax('GET', '/orders', false);
    var orders = [];
    loopArray(res);

    $(function(){
        console.log(orders);
        $('.setPageDiv').change(function(){
            console.log(1);
            pageDivide(parseInt($(this).val()));
        })

        function pageDivide(num){
            var showNum = num;
            var dataL = orders.length;
            var pageNum = Math.ceil(dataL/showNum);
            console.log(pageNum);
            $('#Pagination').pagination(pageNum), {
                num_edge_entries: 1,
                num_display_entries: 4,
                items_per_page: 1,
                prevContent: '上一页',
                nextContent: '下一页',
                callback: function(index){
                    console.log(123);
                    // console.log(showNum * index + '~' + parseInt(showNum * index) + parseInt(showNum));
                }
            }
        }
        pageDivide(4);
    })
    
    
     //获取api中已完成的订单
    // var orders_done = ajax('GET', '', false);
    //loopArray(orders_done);


    
    //反序遍历Array, 正序遍历每个对象， 用editTable()编辑table.
    function loopArray(object){
        for(var i=object.length-1;i>-1;i--){
            var transactions = object[i].transactions[0].item_list[0].items;
            var payer = object[i].payer;
            for(var j=0;j<transactions.length;j++){
                var newObj = [{
                    transaction: transactions[j],
                    payer: payer
                }]
                editTable(transactions[j], payer);
                orders.push(newObj);
            }
        }


    }


    //匹配id, 修改table中的内容.
    function editTable(transactions, payer){
        document.getElementById('item-table').innerHTML += '<tr><td>' + transactions.name + '</td><td>' + transactions.price + '</td><td>' + transactions.quantity + '</td><td>' + transactions.quantity * transactions.price + '</td><td>' + payer.payer_info.first_name + ' ' + payer.payer_info.last_name + '</td><td>' + payer.payer_info.email + '</td><td>' + payer.payment_method + '</td><td>' + payer.status + "</td><td><button class='operateBtn' id='orderDone'>完成</button><button class='operateBtn' id='orderDelete'>删除</button></td></tr>";
    }

</script>

<style>
    .Pagination{
        margin: auto;
        float: right;
        margin-right: 20px;
    }


    
    .font{
        font-weight: bold;
        margin: 10px 20px;

    }
    .table>tbody>tr>th, .table>tbody>tr>td{
        white-space: nowrap;
        padding: 8 40px;
    }

    .container{
        margin: 0 20px;
        padding: 0;
    }

    .operateBtn{
        margin: 0 2px;
    }

    .orderpage{
        height: 60%;
        margin: 0 20px 10px 20px;
        overflow: auto;
    }
</style>